<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head_styles}"></head>
<body>
<div th:replace="~{fragments :: sidebar('impacts')}"></div>
<div class="main-content">
    <h2 class="fw-bold mb-4" th:text="${isNew} ? 'Додати новий запис про вплив' : 'Редагувати запис про вплив #' + ${impact.id}">Форма впливу</h2>
    <div class="card-custom p-4">
        <form th:action="@{/ui/impacts/save}" th:object="${impact}" method="post">
            <input type="hidden" th:field="*{id}" />

            <div class="mb-3">
                <label for="emergency" class="form-label fw-bold">Пов'язана аварія</label>
                <select id="emergency" class="form-select" th:field="*{emergency}" required>
                    <option th:each="e : ${emergencies}"
                            th:value="${e.id}"
                            th:text="${'ID ' + e.id + ': ' + (e.communalType == null ? 'null' : e.communalType) + ' (' + (e.startDate != null ? #temporals.format(e.startDate, 'yyyy-MM-dd') : 'Немає дати') + ')'}"
                            th:selected="${!isNew and impact.emergency != null and impact.emergency.id == e.id}">
                    </option>
                </select>
            </div>

            <div class="mb-3">
                <label for="doseMeasure" class="form-label fw-bold">Вимір дози (Опціонально)</label>
                <select id="doseMeasure" class="form-select" th:field="*{doseMeasure}">
                    <option value="">-- Не вибрано --</option>
                    <option th:each="dm : ${doseMeasures}"
                            th:value="${dm.id}"
                            th:text="${'ID ' + dm.id + ': ' + (dm.doseValue == null ? 'null' : dm.doseValue) + ' Зв (' + (dm.measurementDate != null ? #temporals.format(dm.measurementDate, 'yyyy-MM-dd HH:mm') : 'Немає дати') + ')'}"
                            th:selected="${!isNew and impact.doseMeasure != null and impact.doseMeasure.id == dm.id}">
                    </option>
                </select>
            </div>

            <div class="mb-3">
                <label for="populationGroup" class="form-label fw-bold">Група населення</label>
                <select id="populationGroup" class="form-select" th:field="*{populationGroup}" required>
                    <option value="">-- Виберіть групу --</option>
                    <option value="General Public" th:selected="${!isNew and impact.populationGroup == 'General Public'}">Загальне населення</option>
                    <option value="Emergency Personnel" th:selected="${!isNew and impact.populationGroup == 'Emergency Personnel'}">Персонал НС</option>
                    <option value="Children" th:selected="${!isNew and impact.populationGroup == 'Children'}">Діти</option>
                    <option value="Elderly" th:selected="${!isNew and impact.populationGroup == 'Elderly'}">Літні люди</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="exposureType" class="form-label fw-bold">Тип впливу</label>
                <select id="exposureType" class="form-select" th:field="*{exposureType}" required>
                    <option value="">-- Виберіть тип впливу --</option>
                    <option value="Direct Exposure" th:selected="${!isNew and impact.exposureType == 'Direct Exposure'}">Прямий вплив</option>
                    <option value="Contamination" th:selected="${!isNew and impact.exposureType == 'Contamination'}">Забруднення території</option>
                    <option value="Chronic" th:selected="${!isNew and impact.exposureType == 'Chronic'}">Хронічний</option>
                    <option value="Acute" th:selected="${!isNew and impact.exposureType == 'Acute'}">Гострий</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="healthEffect" class="form-label fw-bold">Ефект на здоров'я</label>
                <select id="healthEffect" class="form-select" th:field="*{healthEffect}" required>
                    <option value="">-- Виберіть ефект --</option>
                    <option value="No Observed Effect" th:selected="${!isNew and impact.healthEffect == 'No Observed Effect'}">Не спостерігався</option>
                    <option value="Mild Symptoms" th:selected="${!isNew and impact.healthEffect == 'Mild Symptoms'}">Легкі симптоми</option>
                    <option value="Acute Radiation Syndrome" th:selected="${!isNew and impact.healthEffect == 'Acute Radiation Syndrome'}">Гострий радіаційний синдром</option>
                    <option value="Long-term Cancers" th:selected="${!isNew and impact.healthEffect == 'Long-term Cancers'}">Довгострокові онкологічні захворювання</option>
                    <option value="Chemical Burns" th:selected="${!isNew and impact.healthEffect == 'Chemical Burns'}">Хімічні опіки</option>
                    <option value="Fatalities" th:selected="${!isNew and impact.healthEffect == 'Fatalities'}">Смертельні випадки</option>
                </select>
            </div>

            <hr>
            <button type="submit" class="btn btn-success me-2"><i class="bi bi-save me-2"></i> Зберегти</button>
            <a href="/ui/impacts" class="btn btn-outline-secondary">Скасувати</a>
        </form>
    </div>
</div>
</body>
</html>